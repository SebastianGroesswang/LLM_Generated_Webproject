<!doctype html>
<html lang="de">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Erschaffe deinen eigenen Character</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    <link href="style.css" rel="stylesheet">
    <style>body {
        background: #f2f3f5
    }</style>
</head>
<body>
<!-- hinzugefügte Navbar -->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark mb-4">
  <div class="container">
    <a class="navbar-brand d-flex align-items-center" href="index.html">
      <!-- Star Wars Logo (Datei: assets/Star_wars_Logo.png) -->
      <img src="assets/Star_wars_Logo.png" alt="Star Wars Logo" class="me-2" style="height:34px; width:auto;">
    </a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNav"
            aria-controls="mainNav" aria-expanded="false" aria-label="Navigation umschalten">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="mainNav">
      <ul class="navbar-nav ms-auto">
        <li class="nav-item">
          <a class="nav-link" href="index.html">Home</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="uebersicht-copilot.html">Übersicht Copilot</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="uebersicht-chatgpt.html">Übersicht ChatGPT</a>
        </li>
      </ul>
    </div>
  </div>
</nav>

<div class="container py-5">
  <div class="card mb-4">
    <div class="card-body">
      <h1 class="h4 mb-0">Erschaffe deinen eigenen Character</h1>
    </div>
  </div>

  <!-- Formularkarte -->
  <div class="card mb-3">
    <div class="card-body">
      <form id="charForm" novalidate>
        <div class="row g-3">
          <div class="col-12 col-md-6">
            <label class="form-label">Name</label>
            <input type="text" class="form-control" id="name" required>
          </div>

          <div class="col-6 col-md-3">
            <label class="form-label">Height (cm)</label>
            <input type="number" class="form-control" id="height" min="0" inputmode="numeric" required>
          </div>

          <div class="col-6 col-md-3">
            <label class="form-label">Mass (kg)</label>
            <input type="number" class="form-control" id="mass" min="0" inputmode="numeric" required>
          </div>

          <div class="col-6 col-md-4">
            <label class="form-label">Hair color</label>
            <input type="text" class="form-control" id="hair_color">
          </div>

          <div class="col-6 col-md-4">
            <label class="form-label">Skin color</label>
            <input type="text" class="form-control" id="skin_color">
          </div>

          <div class="col-6 col-md-4">
            <label class="form-label">Eye color</label>
            <select class="form-select" id="eye_color">
              <option value="">-- auswählen --</option>
              <option>blue</option>
              <option>brown</option>
              <option>green</option>
              <option>hazel</option>
              <option>yellow</option>
              <option>red</option>
              <option>black</option>
              <option>unknown</option>
            </select>
          </div>

          <div class="col-6 col-md-4">
            <label class="form-label">Birth year</label>
            <input type="text" class="form-control" id="birth_year" placeholder="z.B. 19BBY">
          </div>

          <div class="col-6 col-md-4">
            <label class="form-label">Gender</label>
            <select class="form-select" id="gender">
              <option value="">-- auswählen --</option>
              <option value="male">male</option>
              <option value="female">female</option>
              <option value="other">other</option>
            </select>
          </div>

          <!-- Homeworld: ersetzt input durch select, wird via JS gefüllt -->
          <div class="col-12">
            <label class="form-label">Homeworld</label>
            <select class="form-select" id="homeworld" aria-label="Homeworld wählen">
              <option value="">Lade Planeten…</option>
            </select>
          </div>

          <!-- Films: multi-select -->
          <div class="col-12 col-md-6">
            <label class="form-label">Films (mehrfach auswählbar)</label>
            <select class="form-select" id="films" multiple size="6" aria-label="Filme wählen">
              <option value="">Lade Filme…</option>
            </select>
            <div class="form-text">Halten Sie Strg/Cmd gedrückt, um mehrere auszuwählen.</div>
          </div>

          <!-- Species: multi-select -->
          <div class="col-12 col-md-6">
            <label class="form-label">Species (mehrfach auswählbar)</label>
            <select class="form-select" id="species" multiple size="6" aria-label="Species wählen">
              <option value="">Lade Species…</option>
            </select>
          </div>

          <!-- Vehicles: multi-select -->
          <div class="col-12 col-md-6">
            <label class="form-label">Vehicles (mehrfach auswählbar)</label>
            <select class="form-select" id="vehicles" multiple size="6" aria-label="Vehicles wählen">
              <option value="">Lade Vehicles…</option>
            </select>
          </div>

          <!-- Starships: multi-select -->
          <div class="col-12 col-md-6">
            <label class="form-label">Starships (mehrfach auswählbar)</label>
            <select class="form-select" id="starships" multiple size="6" aria-label="Starships wählen">
              <option value="">Lade Starships…</option>
            </select>
          </div>
        </div>

        <div class="mt-3 d-flex gap-2">
          <button type="submit" class="btn btn-primary">Absenden</button>
          <button type="reset" class="btn btn-outline-secondary">Zurücksetzen</button>
          <div id="formAlert" class="ms-auto"></div>
        </div>
      </form>
    </div>
  </div>

  <!-- Preview-Card -->
  <div class="card">
    <div class="card-body">
      <h2 class="h6">Erzeugtes JSON (Vorschau)</h2>
      <pre id="jsonPreview" class="bg-light p-3 rounded" style="max-height:360px;overflow:auto">{} </pre>
    </div>
  </div>
</div>

<!-- Script: Formhandling + Selects befüllen -->
<script>
  function esc(s){ return String(s===null||s===undefined?'':s).replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;').replaceAll('"','&quot;').replaceAll("'",'&#39;'); }
  function splitLinesToArray(text){ return String(text||'').split(/\r?\n/).map(s=>s.trim()).filter(Boolean); }
  function getSelectedValues(id){
    const sel = document.getElementById(id);
    if(!sel) return [];
    return Array.from(sel.selectedOptions).map(o => o.value).filter(Boolean);
  }

  // generischer Loader für Listen-Selects (url, selectId, labelKey: 'name' oder 'title')
  function loadListToSelect(apiUrl, selectId, labelKey){
    const sel = document.getElementById(selectId);
    if(!sel) return;
    sel.innerHTML = '<option value="">Lade…</option>';
    fetch(apiUrl)
      .then(res => {
        if(!res.ok) throw new Error('Netzwerkfehler: ' + res.status);
        return res.json();
      })
      .then(json => {
        const items = Array.isArray(json) ? json : (json.results || json);
        if(!Array.isArray(items) || items.length === 0){
          sel.innerHTML = '<option value="">Keine Einträge</option>';
          return;
        }
        const opts = ['<option value="">-- auswählen --</option>'];
        for(const it of items){
          const label = esc(it[labelKey] || it.name || it.title || 'unbekannt');
          const url = esc(it.url || '');
          opts.push('<option value="'+url+'">'+label+'</option>');
        }
        sel.innerHTML = opts.join('');
      })
      .catch(err => {
        console.error(err);
        sel.innerHTML = '<option value="">Fehler beim Laden</option>';
      });
  }

  // Bestehender Planeten-Loader (bleibt)
  (function loadPlanets(){
    const sel = document.getElementById('homeworld');
    if(!sel) return;
    fetch("https://swapi.info/api/planets")
      .then(res => {
        if(!res.ok) throw new Error('Netzwerkfehler beim Laden der Planeten: ' + res.status);
        return res.json();
      })
      .then(json => {
        const planets = Array.isArray(json) ? json : (json.results || json);
        if(!Array.isArray(planets) || planets.length === 0){
          sel.innerHTML = '<option value="">Keine Planeten gefunden</option>';
          return;
        }
        const opts = ['<option value="">-- auswählen --</option>'];
        for(const p of planets){
          const name = esc(p.name || p.title || 'unbekannt');
          const url  = esc(p.url || '');
          opts.push('<option value="' + url + '">' + name + '</option>');
        }
        sel.innerHTML = opts.join('');
      })
      .catch(err => {
        console.error(err);
        sel.innerHTML = '<option value="">Fehler beim Laden der Planeten</option>';
      });
  })();

  // Loaders für Films, Species, Vehicles, Starships
  loadListToSelect('https://swapi.info/api/films', 'films', 'title');
  loadListToSelect('https://swapi.info/api/species', 'species', 'name');
  loadListToSelect('https://swapi.info/api/vehicles', 'vehicles', 'name');
  loadListToSelect('https://swapi.info/api/starships', 'starships', 'name');

  document.getElementById('charForm').addEventListener('submit', function(e){
    e.preventDefault();
    const alertEl = document.getElementById('formAlert');
    alertEl.innerHTML = '';

    const name = document.getElementById('name').value.trim();
    const height = document.getElementById('height').value.trim();
    const mass = document.getElementById('mass').value.trim();
    const hair_color = document.getElementById('hair_color').value.trim();
    const skin_color = document.getElementById('skin_color').value.trim();
    const eye_color = document.getElementById('eye_color').value;
    const birth_year = document.getElementById('birth_year').value.trim();
    const gender = document.getElementById('gender').value;
    const homeworld = document.getElementById('homeworld').value.trim(); // URL
    // neu: Mehrfachauswahl aus selects
    const films = getSelectedValues('films');
    const species = getSelectedValues('species');
    const vehicles = getSelectedValues('vehicles');
    const starships = getSelectedValues('starships');

    const errors = [];
    if(!name) errors.push('Name ist erforderlich.');
    if(!height || !/^\d+$/.test(height)) errors.push('Height muss eine Zahl sein.');
    if(!mass || !/^\d+$/.test(mass)) errors.push('Mass muss eine Zahl sein.');

    if(errors.length){
      alertEl.innerHTML = '<div class="alert alert-danger mb-0 p-2">' + esc(errors.join(' ')) + '</div>';
      return;
    }

    const payload = {
      name: name,
      height: String(parseInt(height,10)),
      mass: String(parseInt(mass,10)),
      hair_color: hair_color || null,
      skin_color: skin_color || null,
      eye_color: eye_color || null,
      birth_year: birth_year || null,
      gender: gender || null,
      homeworld: homeworld || null,
      films: films,
      species: species,
      vehicles: vehicles,
      starships: starships
    };

    document.getElementById('jsonPreview').textContent = JSON.stringify(payload, null, 2);

    // vorheriger fetch('#', { ... })
    fetch('https://httpbin.org/post', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload)
    })
    .then(res => {
      if(!res.ok) throw new Error('Server-Antwort: ' + res.status);
      return res.json(); // JSON-Antwort von httpbin parsen
    })
    .then(json => {
      // Antwort in Preview anzeigen und Erfolg melden
      document.getElementById('jsonPreview').textContent = JSON.stringify(json, null, 2);
      alertEl.innerHTML = '<div class="alert alert-success mb-0 p-2">Payload erfolgreich an https://httpbin.org/post gesendet.</div>';
      console.log('Server response (json):', json);
    })
    .catch(err => {
      alertEl.innerHTML = '<div class="alert alert-warning mb-0 p-2">Senden fehlgeschlagen: ' + esc(err.message) + '</div>';
      console.error(err);
    });
  });
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI"
        crossorigin="anonymous"></script>

</body>
</html>

