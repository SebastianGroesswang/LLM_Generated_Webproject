<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Detailansicht - SWAPI Person</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
  <link href="style.css" rel="stylesheet">
  <style>body{background:#f2f3f5}</style>
</head>
<body>
  <!-- NAVBAR: Logo links (verweist auf index.html) und rechts Link zurück zur Home -->
  <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm">
    <div class="container">
      <a class="navbar-brand d-flex align-items-center" href="index.html">
        <img src="./assets/star-wars-logo-small.png" alt="Star Wars" width="36" height="36" class="me-2" onerror="this.style.display='none'">
        <span class="fw-semibold">Star Wars</span>
      </a>

      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#detailNav" aria-controls="detailNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse justify-content-end" id="detailNav">
        <ul class="navbar-nav">
          <li class="nav-item"><a class="nav-link" href="index.html">Home</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <main class="container py-4">
    <div class="card mb-3">
      <div class="card-body">
        <h1 class="h4 mb-2" id="title">Person — Detail</h1>
        <p class="text-muted" id="subtitle">Lädt die Daten anhand der id in der URL (z.B. detail.html?id=4)</p>
      </div>
    </div>

    <section id="content">
      <div class="card">
        <div class="card-body">
          <div id="status" class="text-center py-4">
            <div class="spinner-border" role="status"><span class="visually-hidden">Lädt...</span></div>
          </div>

          <div id="details" class="d-none">
            <div class="mb-3">
              <h2 class="h6 d-flex align-items-center justify-content-between">
                Rohdaten (JSON)
                <button class="btn btn-sm btn-outline-secondary" type="button"
                        data-bs-toggle="collapse" data-bs-target="#rawCollapse"
                        aria-expanded="false" aria-controls="rawCollapse">
                  Rohdaten anzeigen
                </button>
              </h2>

              <div class="collapse mt-2" id="rawCollapse">
                <pre id="raw" class="bg-light p-3 rounded" style="max-height:300px;overflow:auto"></pre>
              </div>
            </div>

            <div>
              <h2 class="h6">Felder</h2>
              <dl id="fields" class="row gx-3 gy-2"></dl>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <script>
    // Einfaches Escaping
    function esc(s){ return String(s===null||s===undefined?'':s).replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;').replaceAll('"','&quot;').replaceAll("'",'&#39;'); }

    // Hilfsfunktion: Rendert Werte (Strings, Arrays, Objekte)
    function renderValue(v){
      if (Array.isArray(v)){
        if(v.length===0) return '<span class="text-muted">—</span>';
        const items = v.map(item => {
          if(typeof item === 'string' && item.startsWith('http')) return '<li><a href="'+esc(item)+'" target="_blank" rel="noopener">'+esc(item)+'</a></li>';
          return '<li>'+esc(typeof item === 'object' ? JSON.stringify(item) : item) +'</li>';
        }).join('');
        return '<ul class="mb-0">'+items+'</ul>';
      }
      if (v && typeof v === 'object') return '<pre class="mb-0 bg-white p-2 border rounded" style="white-space:pre-wrap">'+esc(JSON.stringify(v, null, 2))+'</pre>';
      if (typeof v === 'string' && v.startsWith('http')) return '<a href="'+esc(v)+'" target="_blank" rel="noopener">'+esc(v)+'</a>';
      return '<span>'+esc(v)+'</span>';
    }

    // Lese id aus URL
    const params = new URLSearchParams(location.search);
    const id = params.get('id') || '1';
    const statusEl = document.getElementById('status');
    const detailsEl = document.getElementById('details');
    const rawEl = document.getElementById('raw');
    const fieldsEl = document.getElementById('fields');
    const titleEl = document.getElementById('title');
    titleEl.textContent = 'Person — Detail (id=' + esc(id) + ')';

    // Fetch mit then/catch
    fetch('https://swapi.info/api/people/' + encodeURIComponent(id))
      .then(res => {
        if(!res.ok) throw new Error('Netzwerkfehler: ' + res.status);
        return res.json();
      })
      .then(json => {
        // raw JSON
        rawEl.textContent = JSON.stringify(json, null, 2);

        // Felder darstellen
        fieldsEl.innerHTML = '';
        Object.entries(json).forEach(([k,v]) => {
          const dt = document.createElement('dt');
          dt.className = 'col-sm-3 text-muted';
          dt.textContent = k;
          const dd = document.createElement('dd');
          dd.className = 'col-sm-9';
          dd.innerHTML = renderValue(v);
          fieldsEl.appendChild(dt);
          fieldsEl.appendChild(dd);
        });

        statusEl.classList.add('d-none');
        detailsEl.classList.remove('d-none');
      })
      .catch(err => {
        statusEl.innerHTML = '<div class="text-danger">Fehler beim Laden: ' + esc(err.message) + '</div>';
        console.error(err);
      });
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>

</body>
</html>

